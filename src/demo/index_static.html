<!DOCTYPE html>
<html lang="en" style="font-size: .7500rem;">
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1'>

  <title>Svelte app</title>

  <link rel='icon' type='image/png' href='favicon.png'>
  <link rel='stylesheet' href='tailwind.css'>
  <link rel='stylesheet' href='graphlib.css'>

  <script src='graphlib.js'></script>
</head>
<style>
  .pancake_graph2 {
    margin: 20px 10px 20px 40px;
  }

</style>
<body>
<div class="mt-4 flex flex-col md:flex-row md:h-64 justify-between text-sm font-arial mx-1 md:mx-16 md:space-x-8 space-y-4">
  <div id="graph_row1_cell1" class="h-64 md:h-auto flex-auto">
    <div class="pancake_graph h-full pl-16 pt-8 pb-6 pr-4 border border-gray-300"></div>
  </div>
  <div id="graph_row1_cell2" class="h-64 md:h-auto flex-auto ">
    <div class="pancake_graph h-full pl-16 pt-8 pb-6 pr-4 border border-gray-300"></div>
  </div>
  <div id="graph_row1_cell3" class="h-64 md:h-auto flex-auto ">
    <div class="pancake_graph h-full pl-16 pt-8 pb-6 pr-4 border border-gray-300"></div>
  </div>
  <div id="graph_row1_cell4" class="h-64 md:h-auto flex-auto">
    <div class="pancake_graph h-full pl-16 pt-8 pb-6 pr-4 border border-gray-300"></div>
  </div>
</div>


<script>
let i, randomOffset;


const formatValueBPS = (val) => {
    if (val == 0)
      return '';
    function innerFormatter(val, divider) {
      val /= divider;
      if (val > Math.floor(val))
        return val.toFixed(1);
      return Math.floor(val).toString();
    }
    if (val >= 1000000)
      return innerFormatter(val, 1000000) + ' Gbps';
    if (val >= 1000)
      return innerFormatter(val, 1000) + ' Mbps';
    if (val > 0)
      return val + ' Kbps';
    return '0';
  };

function setXTick(val_offset, text, list, limit) {
  let x = (120-((val_offset)%120));
  if (x > limit-10)
    return;
  list.push([x, text]);
}

function xTicksPopulate(offset, limit) {
  let retVal = [[limit-1, 'Now']];
  setXTick(offset+63+120, "00:00", retVal, limit);
  setXTick(offset+63+90, "06:00", retVal, limit);
  setXTick(offset+63+60, "12:00", retVal, limit);
  setXTick(offset+63+30, "18:00", retVal, limit);
  return retVal;
}
let xTicks = xTicksPopulate(0, 60);


let graphMem = {
  values: [[]],
  styles: [
    {
      color: 'SteelBlue',
    }
  ],

  "xTicks": xTicks,
  "yTicks": [
    [256, null],
    [512, null],
    [768, null], 
    [1024,null],
  ],

  "formatValue": (val) => {
    return `${val} MB`;
  },
  "formatTick": (val, label, yAxis) => {
    if (typeof label === 'string')
      return label;
    if (yAxis)
      return `${val} MB`;
    return val.toString();
  },
}
for (i=0; i < 60;i++) {
  if (i%10==0) randomOffset=(450*Math.random())
  graphMem.values[0][i] = 350+Math.floor(Math.random()*50+randomOffset);
}


let graphCpu = {
  values: [
    [],
  ],

  styles: [
    {
      title: 'Potato',
      color: 'Tomato',
    }
  ],

  "xTicks": xTicks,
  "yMax": 100,
  "yTicks": [
    [25, null],
    [50, null],
    [75, null], 
    [100,null],
  ],

  "formatValue": (val) => {
    return `${val}%`;
  },
}
for (i=0; i < 60;i++) {
  if (i%10==0) randomOffset=(75*Math.random())
  graphCpu.values[0][i] = Math.floor(Math.random()*30+randomOffset);
}

let graphConn = {
  values: [
    []
  ],

  styles: [
    {
      class: 'text-indigo-600'
    }
  ],

  "xTicks": xTicks,
  "yTicks": [
    250,
    500,
    750, 
    1000,
  ].map(tick=>[tick, tick==0?'':tick.toString()]),

  "formatValue": (val, type) => {
    if (type === 'tooltip')
      return `${val} connections`;
    if (val === 0)
      return '';
    return val.toString();
  },
}
for (i=0; i < 60;i++) {
  if (i%5==0) randomOffset=(250*Math.random())
  if (i%10==0) randomOffset+=(250*Math.random())
  graphConn.values[0][i] = 200+Math.floor(Math.random()*100+randomOffset);
}

let graphThroughput =
{
  values: [
    [
      54,572,6211,4540,8432,8179,8828,61,16,18,12,13,13,12,12,12,12,11,11,12,11,13,23,12,12,17,236,469,40,58,721,17,12,13,10,13,348,786,2026,1030,32,11,20,11,12,12,12,12,10,10,10,12,12,12,45,378,326,684,576,453
    ],
  ],

  styles: [
    {
      color: 'orange',
    }
  ],
  "xTicks": xTicks,
  "yTicks": [
    [2500, null],
    [5000, null],
    [7500, null], 
    [10000,null],
  ],
  "formatValue": formatValueBPS
}

try {
  var appMem = new GraphLib.LineChart({
    target: document.getElementById('graph_row1_cell1').getElementsByClassName('pancake_graph')[0],
    props: graphMem,
  });
} catch(e) {
  console.log(e);
}
try {
  var appThroughput = new GraphLib.LineChart({
    target: document.getElementById('graph_row1_cell2').getElementsByClassName('pancake_graph')[0],
    props: graphThroughput,
  });
} catch(e) {
  console.log(e);
}
try {
  var appCpu = new GraphLib.LineChart({
    target: document.getElementById('graph_row1_cell3').getElementsByClassName('pancake_graph')[0],
    props: graphCpu,
  });
} catch(e) {
  console.log(e);
}
try {
  var appConn = new GraphLib.LineChart({
    target: document.getElementById('graph_row1_cell4').getElementsByClassName('pancake_graph')[0],
    props: graphConn,
  });

} catch(e) {
  console.log(e);
}


</script>
<style>

</style>
<div class="mt-4 flex flex-col md:flex-row md:h-64 justify-between text-sm font-arial mx-1 md:mx-16 md:space-x-8 space-y-4">
  <div id="graph_row2_cell1" class="h-64 md:h-auto flex-auto border border-gray-300 md:w-1/4">
    <div class="pancake_graph h-full "></div>
  </div>
  <div id="graph_row2_cell2" class="h-64 md:h-auto flex-auto border border-gray-300 md:w-1/4">
    <div class="pancake_graph h-full "></div>
  </div>
  <div id="graph_row2_cell3" class="h-64 md:h-auto flex-auto border border-gray-300 md:w-1/4">
    <div class="pancake_graph h-full pl-24 pb-8 pt-4 pr-10 "></div>
  </div>
  <div id="graph_row2_cell4" class="border border-gray-300 md:w-1/4">
    <div class="pancake_graph relative h-full w-64 mr-32"></div>
  </div>
</div>

<script>

let graphMalware = {...graphCpu, xTicks: [], yTicks: [], yMax: 100, styles: [{class: 'text-orange-400'}]};
try {
  var appMalware = new GraphLib.LineChart({
    target: document.getElementById('graph_row2_cell1').getElementsByClassName('pancake_graph')[0],
    props: graphMalware,
  });
} catch(e) {
  console.log(e);
}

let graphBar = {};
try {
  var appBarChart = new GraphLib.BarChart({
    target: document.getElementById('graph_row2_cell3').getElementsByClassName('pancake_graph')[0],
    props: {
      values:[...Array(8).keys()].map(()=>Math.floor(Math.random()*10000)),
      styles: [
        { label: 'label1', class: 'text-orange-300', style:''},
        { label: 'label2', class: 'text-orange-400', style:''},
        { label: 'label3', class: 'text-orange-500', style:''},
        { label: 'label4 asdf asdf asf', class: 'text-orange-600', style:''},
        { label: 'label5', class: 'text-gray-400', style:''},
      ],
      xTicks: [
        [0,''],
        [2500, null],
        [6000],
        [8000]
      ]
    },
  });
} catch(e) {
  console.log(e);
}

let pieStylesCount = 5;
let pieStyles = [
  {label: 'label10',               class: 'text-orange-500'},
  {label: 'label11',               class: 'text-orange-600'},
  {label: 'label12',               class: 'text-orange-700'},
  {label: 'label1',               color:'rgb(44, 82, 130)'},
  {label: 'label2 (extra info)',  color:'rgb(43, 108, 176)'},
  {label: 'label3 (aaaaaaaaaaaaaaaaaaaaaaa)', color:'rgb(49, 130, 206)'},
  {label: 'label4',               color:'rgb(66, 153, 225)'},
  {label: 'label5',               color: 'rgb(99, 179, 237)'},
  {label: 'label6',               color: 'rgb(144, 205, 244)'},

  {label: 'Misc',                 class: 'text-gray-700'},
];

try {
  var appPie = new GraphLib.PieChart({
    target: document.getElementById('graph_row2_cell4').getElementsByClassName('pancake_graph')[0],
    props: {
      classLegend: 'w-32 h-full',
      cutout: 0,
      radius: 45,
      values: [...Array(pieStylesCount+10).keys()].map(()=>Math.floor(Math.random()*10000)),
      styles: [...pieStyles.slice(0,pieStylesCount-1), pieStyles[pieStyles.length-1]],
    },
  });
} catch(e) {
  console.log(e);
}


let graphDual2 = {
  values: [
    [],
    [],
    [],
  ],

  styles: [
    {class: 'text-indigo-200',},
    {class: 'text-indigo-400',},
    {class: 'text-indigo-600',},
  ],

  yMax: 2000,
  formatValue: formatValueBPS
}
for (i=0; i < 60;i++) {
  if (i%5==0) randomOffset=(450*Math.random())
  if (i%7==0) randomOffset+=(250*Math.random())
  graphDual2.values[1][i] = 200+Math.floor(Math.random()*100+randomOffset);
}
for (i=0; i < 60;i++) {
  if (i%7==0) randomOffset=(350*Math.random())
  if (i%12==0) randomOffset+=(250*Math.random())
  graphDual2.values[2][i] = 200+Math.floor(Math.random()*100+randomOffset);
}
for (i=0; i < 60;i++) {
  graphDual2.values[0][i] = graphDual2.values[1][i] + graphDual2.values[2][i];
}
try {
  var appMalware2 = new GraphLib.LineChart({
    target: document.getElementById('graph_row2_cell2').getElementsByClassName('pancake_graph')[0],
    props: graphDual2,
  });
} catch(e) {
  console.log(e);
}


</script>
<div class="mt-4 flex flex-row justify-between text-sm font-arial mx-1 md:mx-16 md:space-x-8 space-y-4 md:space-y-0 bg-gray-300 p-4">
  <div id="graph_row3_cell1" class="w-64 h-32 self-top pl-8 p-2">
    <div class="pancake_graph h-full"></div>
  </div>
  <div id="graph_row3_cell2" class="w-64 h-32 self-top">
    <div class="pancake_graph h-full"></div>
  </div>
  <div id="graph_row3_cell3" class="w-64 h-32 self-top">
    <div class="pancake_graph h-full bg-black border-orange-600 border-4"></div>
  </div>
  <div id="graph_row3_cell4" class="w-32 h-32 self-top">
    <div class="pancake_graph h-full"></div>
  </div>
  <div id="graph_row3_cell5" class="w-32 h-32 self-top">
    <div class="pancake_graph h-full"></div>
  </div>
  <div id="graph_row3_cell6" class="w-56 h-56 self-center border-8 p-2 bg-gray-600 border-gray-600 rounded-full">
    <div class="pancake_graph h-full"></div>
  </div>
</div>

<script>

try {
  var app_row3_cell1 = new GraphLib.LineChart({
    target: document.getElementById('graph_row3_cell1').getElementsByClassName('pancake_graph')[0],
    props: {
      tooltip: false,
      yMax: 500,
      yTicks: [[100, null], [200, null],[300, null], [400, null]],
      values: [
        [...Array(30).keys()].map((i)=>Math.floor((i%7==0?Math.random()*250:100)+150+Math.random()*150)),
        [...Array(30).keys()].map(()=>Math.floor((i%7==0?Math.random()*100:0)+150+Math.random()*150)),
        [...Array(30).keys()].map(()=>Math.floor((i%7==0?Math.random()*155:0)+150+Math.random()*150)),
      ],
      styles: [
        { class: 'text-orange-300'},
        { class: 'text-orange-400'},
        { class: 'text-orange-500'},
      ],
    }
  });
} catch(e) {
  console.log(e);
}

try {
  var app_row3_cell1 = new GraphLib.LineChart({
    target: document.getElementById('graph_row3_cell2').getElementsByClassName('pancake_graph')[0],
    props: {
      tooltip: false,
      yMax: 500,
      //yTicks: [[100, null], [200, null],[300, null], [400, null]],
      values: [
      [...Array(30).keys()].map((i)=>Math.floor((i%7==0?Math.random()*150:100)+150+Math.random()*150)),
      ],
      styles: [
        { color: 'hsl(205, 41%, 45.9%)'},
      ],
    }
  });
} catch(e) {
  console.log(e);
}

try {
  var app_row3_cell3 = new GraphLib.LineChart({
    target: document.getElementById('graph_row3_cell3').getElementsByClassName('pancake_graph')[0],
    props: {
      yMax: 500,
      values: [
        [...Array(30).keys()].map((i)=>Math.floor((i%7==0?Math.random()*250:100)+150+Math.random()*150)),
        [...Array(30).keys()].map(()=>Math.floor((i%7==0?Math.random()*100:0)+150+Math.random()*150)),
      ],
      styles: [
        { class: 'text-blue-500', fill: false},
        { class: 'text-orange-500', fill: false},
      ],
    }
  });
} catch(e) {
  console.log(e);
}

try {
  var app_row3_cell4 = new GraphLib.Pie({
    target: document.getElementById('graph_row3_cell4').getElementsByClassName('pancake_graph')[0],
    props: {
      cutout: 0,
      radius: 45,
      values: [...Array(3).keys()].map(()=>Math.floor(Math.random()*10000)),
      styles: [
        {label: 'label10',               class: 'text-orange-500'},
        {label: 'label11',               class: 'text-orange-600'},
        {label: 'label12',               class: 'text-orange-700'},
      ],
    },
  });
} catch(e) {
  console.log(e);
}

try {
  var app_row3_cell5 = new GraphLib.Pie({
    target: document.getElementById('graph_row3_cell5').getElementsByClassName('pancake_graph')[0],
    props: {
      class: 'w-16 h-16',
      cutout: 0,
      radius: 45,
      values: [...Array(3).keys()].map(()=>Math.floor(Math.random()*10000)),
      styles: [
        {label: 'label10',               class: 'text-blue-500'},
        {label: 'label11',               class: 'text-blue-600'},
        {label: 'label12',               class: 'text-blue-700'},
      ],
    },
  });
} catch(e) {
  console.log(e);
}

try {
  var app_row3_cell6 = new GraphLib.Pie({
    target: document.getElementById('graph_row3_cell6').getElementsByClassName('pancake_graph')[0],
    props: {
      class: 'width_pie',
      cutout: 0,
      radius: 50,
      values: [...Array(3).keys()].map(()=>Math.floor(Math.random()*10000)),
      styles: [
        {label: 'Red',               color: '#d44'},
        {label: 'Green',             color: '#4d4'},
        {label: 'Blue',              color: '#44d'},
      ],
    },
  });
} catch(e) {
  console.log(e);
}

</script>



<div id="dashboard__id__dual" class="mt-4 border bg-white p-3 md:mx-16">
  <div class="pancake_graph h-64 pl-16 pt-8 pb-4 pr-2 dashboard__w-trendgraph"></div>
</div>
<script>
let graphDual = {
  values: [
    [],
    [],
    [],
  ],

  styles: [
    {class: 'text-gray-300'},
    {class: 'text-orange-600', fill: false},
    {class: 'text-blue-600', fill: false},
  ],

  "xTicks": xTicksPopulate(0, 120),
  "yTicks": [
    500,
    1000,
    1500, 
    2000,
  ].map(tick=>[tick, tick==0?'':null]),

  "formatValue": formatValueBPS,
}
for (i=0; i < 120;i++) {
  if (i%5==0) randomOffset=(250*Math.random())
  if (i%3==0) randomOffset+=(450*Math.random())
  graphDual.values[1][i] = 200+Math.floor(Math.random()*100+randomOffset);
}
for (i=0; i < 120;i++) {
  if (i%7==0) randomOffset=(250*Math.random())
  if (i%12==0) randomOffset+=(450*Math.random())
  graphDual.values[2][i] = 200+Math.floor(Math.random()*100+randomOffset);
}
for (i=0; i < 120;i++) {
  graphDual.values[0][i] = graphDual.values[1][i] + graphDual.values[2][i];
}

try {
  var appDual = new GraphLib.LineChart({
    target: document.getElementById('dashboard__id__dual').getElementsByClassName('pancake_graph')[0],
    props: graphDual,
  });
} catch(e) {
  console.log(e);
}




if (1) {
  let offset = 0;

  function update() {
    offset++;

    function updateLine(currData, currApp) {
      currData.xTicks = xTicksPopulate(offset,60),
      currData.values[0].push(currData.values[0].shift()); 
      //[[...currData.values[0].slice(offset%60,60), ...currData.values[0].slice(0,offset%60)]];
      if (currApp)  currApp.$set({
        xTicks: currData.xTicks,
        values: currData.values
      });
    }

    if (appMem) updateLine(graphMem, appMem);
    if (appMem) updateLine(graphCpu, appCpu);
    if (appMem) updateLine(graphThroughput, appThroughput);

    if (graphDual) {
      if (appDual) {
        graphDual.xTicks = xTicksPopulate(offset, 120);
        graphDual.values[0].push(graphDual.values[0].shift()); 
        graphDual.values[1].push(graphDual.values[1].shift()); 
        graphDual.values[2].push(graphDual.values[2].shift()); 
        appDual.$set({
          xTicks: graphDual.xTicks,
          values: graphDual.values
        });
      }
    }

    if (offset%5==1) {
      let tmp2 = Math.floor(Math.random()*30+1)*100;

      let yTicks = [
        Math.floor(1*(tmp2/4)),
        Math.floor(2*(tmp2/4)),
        Math.floor(3*(tmp2/4)),
        Math.floor(4*(tmp2/4)),
      ].map(tick=>[tick, tick==0?'':tick.toString()]);
      appConn.$set({yTicks});
    }
    if (appMem) updateLine(graphConn, appConn);

    if (appPie && offset%2==0) {
      if (offset%4==0) {
        let pieOff = Math.floor(Math.random()*7);
        pieStylesCount = Math.floor(2+Math.random()*5);
        appPie.$set({
          //values: [...Array(pieStylesCount).keys()].map((index)=>Math.floor(Math.random()*100+10*index)),
          styles: [...pieStyles.slice(0, pieStylesCount-1), pieStyles[pieStyles.length-1]],
        })
      }
      else {
        appPie.$set({
          values: [...Array(pieStylesCount).keys()].map((index)=>Math.floor(Math.random()*100+10*index)),
        });
      }
    }

    if (appBarChart) {
      let newValues = appBarChart.values.map(()=>Math.floor(Math.random()*10000));
      let newValuesMax = Math.floor(Math.max.apply(null, newValues))+100;
      appBarChart.$set({
        values: newValues,
        xTicks: [
          [0, ''],
          [Math.floor((newValuesMax+99)/2), (Math.floor(((newValuesMax+99)/200))*100).toString()],
          [Math.floor((newValuesMax+99)/100)*100, null],
        ],
        xMax: Math.floor((newValuesMax+99)/100)*100,

      });
    }

  }// update

  let lastUpdate = 0;
  const doUpdate = (()=>{
      if (Math.floor(Date.now()/1000) !== lastUpdate)
        update();
      lastUpdate = Math.floor(Date.now()/1000);
      setTimeout(doUpdate, 1000);
  });
  setTimeout(doUpdate, 5000);
}

</script>
</body>
</html>
